"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[431],{4470:(e,t,n)=>{n.d(t,{K:()=>c,w:()=>a});var r=n(3829),i=n(82);let o="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),l="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function s(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function a(e){return new i.k_({props:{handleKeyDown:c(e)}})}function c(e){let t=function(e){let t=Object.create(null);for(let n in e)t[function(e){let t,n,r,i,l=e.split(/-(?!$)/),s=l[l.length-1];"Space"==s&&(s=" ");for(let e=0;e<l.length-1;e++){let s=l[e];if(/^(cmd|meta|m)$/i.test(s))i=!0;else if(/^a(lt)?$/i.test(s))t=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else if(/^s(hift)?$/i.test(s))r=!0;else if(/^mod$/i.test(s))o?i=!0:n=!0;else throw Error("Unrecognized modifier name: "+s)}return t&&(s="Alt-"+s),n&&(s="Ctrl-"+s),i&&(s="Meta-"+s),r&&(s="Shift-"+s),s}(n)]=e[n];return t}(e);return function(e,n){let i=(0,r.xT)(n),o,a=t[s(i,n)];if(a&&a(e.state,e.dispatch,e))return!0;if(1==i.length&&" "!=i){if(n.shiftKey){let r=t[s(i,n,!1)];if(r&&r(e.state,e.dispatch,e))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(l&&n.ctrlKey&&n.altKey)&&(o=r.E3[n.keyCode])&&o!=i){let r=t[s(o,n)];if(r&&r(e.state,e.dispatch,e))return!0}}return!1}}},5821:(e,t,n)=>{n.d(t,{ZS:()=>C,b6:()=>w,tN:()=>y});var r=n(2892),i=n(5641),o=n(82);class l{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){let n,r,i,o;if(0==this.eventCount)return null;let a=this.items.length;for(;;a--)if(this.items.get(a-1).selection){--a;break}t&&(r=(n=this.remapping(a,this.items.length)).maps.length);let c=e.tr,p=[],d=[];return this.items.forEach((e,t)=>{if(!e.step){n||(r=(n=this.remapping(a,t+1)).maps.length),r--,d.push(e);return}if(n){d.push(new s(e.map));let t=e.step.map(n.slice(r)),i;t&&c.maybeStep(t).doc&&(i=c.mapping.maps[c.mapping.maps.length-1],p.push(new s(i,void 0,void 0,p.length+d.length))),r--,i&&n.appendMap(i,r)}else c.maybeStep(e.step);if(e.selection)return i=n?e.selection.map(n.slice(r)):e.selection,o=new l(this.items.slice(0,a).append(d.reverse().concat(p)),this.eventCount-1),!1},this.items.length,0),{remaining:o,transform:c,selection:i}}addTransform(e,t,n,r){var i,o;let a,p=[],d=this.eventCount,f=this.items,u=!r&&f.length?f.get(f.length-1):null;for(let n=0;n<e.steps.length;n++){let i=e.steps[n].invert(e.docs[n]),o=new s(e.mapping.maps[n],i,t),l;(l=u&&u.merge(o))&&(o=l,n?p.pop():f=f.slice(0,f.length-1)),p.push(o),t&&(d++,t=void 0),r||(u=o)}let h=d-n.depth;return h>c&&(i=f,o=h,i.forEach((e,t)=>{if(e.selection&&0==o--)return a=t,!1}),f=i.slice(a),d-=h),new l(f.append(p),d)}remapping(e,t){let n=new i.X9;return this.items.forEach((t,r)=>{let i=null!=t.mirrorOffset&&r-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,i)},e,t),n}addMaps(e){return 0==this.eventCount?this:new l(this.items.append(e.map(e=>new s(e))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-t),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(e=>{e.selection&&a--},r);let c=t;this.items.forEach(t=>{let r=i.getMirror(--c);if(null==r)return;o=Math.min(o,r);let l=i.maps[r];if(t.step){let o=e.steps[r].invert(e.docs[r]),p=t.selection&&t.selection.map(i.slice(c+1,r));p&&a++,n.push(new s(l,o,p))}else n.push(new s(l))},r);let p=[];for(let e=t;e<o;e++)p.push(new s(i.maps[e]));let d=new l(this.items.slice(0,r).append(p).append(n),a);return d.emptyItemCount()>500&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{!t.step&&e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,i=[],o=0;return this.items.forEach((r,l)=>{if(l>=e)i.push(r),r.selection&&o++;else if(r.step){let e=r.step.map(t.slice(n)),l=e&&e.getMap();if(n--,l&&t.appendMap(l,n),e){let a=r.selection&&r.selection.map(t.slice(n));a&&o++;let c=new s(l.invert(),e,a),p,d=i.length-1;(p=i.length&&i[d].merge(c))?i[d]=p:i.push(c)}}else r.map&&n--},this.items.length,0),new l(r.A.from(i.reverse()),o)}}l.empty=new l(r.A.empty,0);class s{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new s(t.getMap().invert(),t,this.selection)}}}class a{constructor(e,t,n,r,i){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r,this.prevComposition=i}}let c=20;function p(e){let t=[];for(let n=e.length-1;n>=0&&0==t.length;n--)e[n].forEach((e,n,r,i)=>t.push(r,i));return t}function d(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let i=t.map(e[r],1),o=t.map(e[r+1],-1);i<=o&&n.push(i,o)}return n}let f=!1,u=null;function h(e){let t=e.plugins;if(u!=t){f=!1,u=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){f=!0;break}}return f}let m=new o.hs("history"),g=new o.hs("closeHistory");function w(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new o.k_({key:m,state:{init:()=>new a(l.empty,l.empty,null,0,-1),apply:(t,n,r)=>(function(e,t,n,r){let i=n.getMeta(m),o;if(i)return i.historyState;n.getMeta(g)&&(e=new a(e.done,e.undone,null,0,-1));let s=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(s&&s.getMeta(m))if(s.getMeta(m).redo)return new a(e.done.addTransform(n,void 0,r,h(t)),e.undone,p(n.mapping.maps),e.prevTime,e.prevComposition);else return new a(e.done,e.undone.addTransform(n,void 0,r,h(t)),null,e.prevTime,e.prevComposition);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))if(o=n.getMeta("rebased"))return new a(e.done.rebased(n,o),e.undone.rebased(n,o),d(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);else return new a(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),d(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);{let i=n.getMeta("composition"),o=0==e.prevTime||!s&&e.prevComposition!=i&&(e.prevTime<(n.time||0)-r.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((e,r)=>{for(let i=0;i<t.length;i+=2)e<=t[i+1]&&r>=t[i]&&(n=!0)}),n}(n,e.prevRanges)),c=s?d(e.prevRanges,n.mapping):p(n.mapping.maps);return new a(e.done.addTransform(n,o?t.selection.getBookmark():void 0,r,h(t)),l.empty,c,n.time,null==i?e.prevComposition:i)}})(n,r,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r="historyUndo"==n?y:"historyRedo"==n?C:null;return!!r&&(t.preventDefault(),r(e.state,e.dispatch))}}}})}function v(e,t){return(n,r)=>{let i=m.getState(n);if(!i||0==(e?i.undone:i.done).eventCount)return!1;if(r){let o=function(e,t,n){let r=h(t),i=m.get(t).spec.config,o=(n?e.undone:e.done).popEvent(t,r);if(!o)return null;let l=o.selection.resolve(o.transform.doc),s=(n?e.done:e.undone).addTransform(o.transform,t.selection.getBookmark(),i,r),c=new a(n?s:o.remaining,n?o.remaining:s,null,0,-1);return o.transform.setSelection(l).setMeta(m,{redo:n,historyState:c})}(i,n,e);o&&r(t?o.scrollIntoView():o)}return!0}}let y=v(!1,!0),C=v(!0,!0);v(!1,!1),v(!0,!1)},8106:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(82),i=n(5641);function o(e={}){return new r.k_({view:t=>new l(t,e)})}class l{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!=(n=t.width)?n:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t,n=this.editorView.state.doc.resolve(this.cursorPos),r=!n.parent.inlineContent,i,o=this.editorView.dom,l=o.getBoundingClientRect(),s=l.width/o.offsetWidth,a=l.height/o.offsetHeight;if(r){let e=n.nodeBefore,t=n.nodeAfter;if(e||t){let n=this.editorView.nodeDOM(this.cursorPos-(e?e.nodeSize:0));if(n){let r=n.getBoundingClientRect(),o=e?r.bottom:r.top;e&&t&&(o=(o+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let l=this.width/2*a;i={left:r.left,right:r.right,top:o-l,bottom:o+l}}}}if(!i){let e=this.editorView.coordsAtPos(this.cursorPos),t=this.width/2*s;i={left:e.left-t,right:e.left+t,top:e.top,bottom:e.bottom}}let c=this.editorView.dom.offsetParent;if(!this.element&&(this.element=c.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r),c&&(c!=document.body||"static"!=getComputedStyle(c).position)){let n=c.getBoundingClientRect(),r=n.width/c.offsetWidth,i=n.height/c.offsetHeight;e=n.left-c.scrollLeft*r,t=n.top-c.scrollTop*i}else e=-pageXOffset,t=-pageYOffset;this.element.style.left=(i.left-e)/s+"px",this.element.style.top=(i.top-t)/a+"px",this.element.style.width=(i.right-i.left)/s+"px",this.element.style.height=(i.bottom-i.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),r=n&&n.type.spec.disableDropCursor,o="function"==typeof r?r(this.editorView,t,e):r;if(t&&!o){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=(0,i.Um)(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}},8739:(e,t,n)=>{n.d(t,{z:()=>c});var r=n(4470),i=n(82),o=n(8622),l=n(8660);class s extends i.LN{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return s.valid(n)?new s(n):i.LN.near(n)}content(){return o.Ji.empty}eq(e){return e instanceof s&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw RangeError("Invalid input for GapCursor.fromJSON");return new s(e.resolve(t.pos))}getBookmark(){return new a(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),r=e.node(t);if(0==n){if(r.type.spec.isolating)return!0;continue}for(let e=r.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),r=e.node(t);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let e=r.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}}return!0}(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let r=t.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&s.valid(e))return e;let r=e.pos,o=null;for(let n=e.depth;;n--){let i=e.node(n);if(t>0?e.indexAfter(n)<i.childCount:e.index(n)>0){o=i.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;r+=t;let l=e.doc.resolve(r);if(s.valid(l))return l}for(;;){let l=t>0?o.firstChild:o.lastChild;if(!l){if(o.isAtom&&!o.isText&&!i.nh.isSelectable(o)){e=e.doc.resolve(r+o.nodeSize*t),n=!1;continue e}break}o=l,r+=t;let a=e.doc.resolve(r);if(s.valid(a))return a}return null}}}s.prototype.visible=!1,s.findFrom=s.findGapCursorFrom,i.LN.jsonID("gapcursor",s);class a{constructor(e){this.pos=e}map(e){return new a(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return s.valid(t)?new s(t):i.LN.near(t)}}function c(){return new i.k_({props:{decorations:h,createSelectionBetween:(e,t,n)=>t.pos==n.pos&&s.valid(n)?new s(n):null,handleClick:f,handleKeyDown:p,handleDOMEvents:{beforeinput:u}}})}let p=(0,r.K)({ArrowLeft:d("horiz",-1),ArrowRight:d("horiz",1),ArrowUp:d("vert",-1),ArrowDown:d("vert",1)});function d(e,t){let n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,r,o){let l=e.selection,a=t>0?l.$to:l.$from,c=l.empty;if(l instanceof i.U3){if(!o.endOfTextblock(n)||0==a.depth)return!1;c=!1,a=e.doc.resolve(t>0?a.after():a.before())}let p=s.findGapCursorFrom(a,t,c);return!!p&&(r&&r(e.tr.setSelection(new s(p))),!0)}}function f(e,t,n){if(!e||!e.editable)return!1;let r=e.state.doc.resolve(t);if(!s.valid(r))return!1;let o=e.posAtCoords({left:n.clientX,top:n.clientY});return!(o&&o.inside>-1&&i.nh.isSelectable(e.state.doc.nodeAt(o.inside)))&&(e.dispatch(e.state.tr.setSelection(new s(r))),!0)}function u(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof s))return!1;let{$from:n}=e.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!r)return!1;let l=o.FK.empty;for(let e=r.length-1;e>=0;e--)l=o.FK.from(r[e].createAndFill(null,l));let a=e.state.tr.replace(n.pos,n.pos,new o.Ji(l,0,0));return a.setSelection(i.U3.near(a.doc.resolve(n.pos+1))),e.dispatch(a),!1}function h(e){if(!(e.selection instanceof s))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",l.zF.create(e.doc,[l.NZ.widget(e.selection.head,t,{key:"gapcursor"})])}},9401:(e,t,n)=>{n.d(t,{$f:()=>R,G2:()=>C,I$:()=>S,Im:()=>B,Qv:()=>c,Sd:()=>v,Z1:()=>A,_G:()=>d,_e:()=>h,bh:()=>b,eB:()=>p,eT:()=>w,ec:()=>O,hy:()=>V,ic:()=>s,iz:()=>M,pC:()=>x,yY:()=>k,y_:()=>E});var r,i=n(5641),o=n(8622),l=n(82);let s=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function a(e,t){let{$cursor:n}=e.selection;return n&&(t?t.endOfTextblock("backward",e):!(n.parentOffset>0))?n:null}let c=(e,t,n)=>{let r=a(e,n);if(!r)return!1;let s=m(r);if(!s){let n=r.blockRange(),o=n&&(0,i.jP)(n);return null!=o&&(t&&t(e.tr.lift(n,o).scrollIntoView()),!0)}let c=s.nodeBefore;if(I(e,s,t,-1))return!0;if(0==r.parent.content.size&&(u(c,"end")||l.nh.isSelectable(c)))for(let n=r.depth;;n--){let a=(0,i.$L)(e.doc,r.before(n),r.after(n),o.Ji.empty);if(a&&a.slice.size<a.to-a.from){if(t){let n=e.tr.step(a);n.setSelection(u(c,"end")?l.LN.findFrom(n.doc.resolve(n.mapping.map(s.pos,-1)),-1):l.nh.create(n.doc,s.pos-c.nodeSize)),t(n.scrollIntoView())}return!0}if(1==n||r.node(n-1).childCount>1)break}return!!c.isAtom&&s.depth==r.depth-1&&(t&&t(e.tr.delete(s.pos-c.nodeSize,s.pos).scrollIntoView()),!0)},p=(e,t,n)=>{let r=a(e,n);if(!r)return!1;let i=m(r);return!!i&&f(e,i,t)},d=(e,t,n)=>{let r=g(e,n);if(!r)return!1;let i=y(r);return!!i&&f(e,i,t)};function f(e,t,n){let r=t.nodeBefore,s=t.pos-1;for(;!r.isTextblock;s--){if(r.type.spec.isolating)return!1;let e=r.lastChild;if(!e)return!1;r=e}let a=t.nodeAfter,c=t.pos+1;for(;!a.isTextblock;c++){if(a.type.spec.isolating)return!1;let e=a.firstChild;if(!e)return!1;a=e}let p=(0,i.$L)(e.doc,s,c,o.Ji.empty);if(!p||p.from!=s||p instanceof i.Ln&&p.slice.size>=c-s)return!1;if(n){let t=e.tr.step(p);t.setSelection(l.U3.create(t.doc,s)),n(t.scrollIntoView())}return!0}function u(e,t,n=!1){for(let r=e;r;r="start"==t?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)break}return!1}let h=(e,t,n)=>{let{$head:r,empty:i}=e.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):r.parentOffset>0)return!1;o=m(r)}let s=o&&o.nodeBefore;return!!s&&!!l.nh.isSelectable(s)&&(t&&t(e.tr.setSelection(l.nh.create(e.doc,o.pos-s.nodeSize)).scrollIntoView()),!0)};function m(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function g(e,t){let{$cursor:n}=e.selection;return n&&(t?t.endOfTextblock("forward",e):!(n.parentOffset<n.parent.content.size))?n:null}let w=(e,t,n)=>{let r=g(e,n);if(!r)return!1;let s=y(r);if(!s)return!1;let a=s.nodeAfter;if(I(e,s,t,1))return!0;if(0==r.parent.content.size&&(u(a,"start")||l.nh.isSelectable(a))){let n=(0,i.$L)(e.doc,r.before(),r.after(),o.Ji.empty);if(n&&n.slice.size<n.to-n.from){if(t){let r=e.tr.step(n);r.setSelection(u(a,"start")?l.LN.findFrom(r.doc.resolve(r.mapping.map(s.pos)),1):l.nh.create(r.doc,r.mapping.map(s.pos))),t(r.scrollIntoView())}return!0}}return!!a.isAtom&&s.depth==r.depth-1&&(t&&t(e.tr.delete(s.pos,s.pos+a.nodeSize).scrollIntoView()),!0)},v=(e,t,n)=>{let{$head:r,empty:i}=e.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):r.parentOffset<r.parent.content.size)return!1;o=y(r)}let s=o&&o.nodeAfter;return!!s&&!!l.nh.isSelectable(s)&&(t&&t(e.tr.setSelection(l.nh.create(e.doc,o.pos)).scrollIntoView()),!0)};function y(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}let C=(e,t)=>{let n=e.selection,r=n instanceof l.nh,o;if(r){if(n.node.isTextblock||!(0,i.n9)(e.doc,n.from))return!1;o=n.from}else if(null==(o=(0,i.N0)(e.doc,n.from,-1)))return!1;if(t){let n=e.tr.join(o);r&&n.setSelection(l.nh.create(n.doc,o-e.doc.resolve(o).nodeBefore.nodeSize)),t(n.scrollIntoView())}return!0},b=(e,t)=>{let n=e.selection,r;if(n instanceof l.nh){if(n.node.isTextblock||!(0,i.n9)(e.doc,n.to))return!1;r=n.to}else if(null==(r=(0,i.N0)(e.doc,n.to,1)))return!1;return t&&t(e.tr.join(r).scrollIntoView()),!0},k=(e,t)=>{let{$from:n,$to:r}=e.selection,o=n.blockRange(r),l=o&&(0,i.jP)(o);return null!=l&&(t&&t(e.tr.lift(o,l).scrollIntoView()),!0)},x=(e,t)=>{let{$head:n,$anchor:r}=e.selection;return!!n.parent.type.spec.code&&!!n.sameParent(r)&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function T(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}let S=(e,t)=>{let{$head:n,$anchor:r}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),o=n.indexAfter(-1),s=T(i.contentMatchAt(o));if(!s||!i.canReplaceWith(o,o,s))return!1;if(t){let r=n.after(),i=e.tr.replaceWith(r,r,s.createAndFill());i.setSelection(l.LN.near(i.doc.resolve(r),1)),t(i.scrollIntoView())}return!0},A=(e,t)=>{let n=e.selection,{$from:r,$to:i}=n;if(n instanceof l.i5||r.parent.inlineContent||i.parent.inlineContent)return!1;let o=T(i.parent.contentMatchAt(i.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){let n=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,s=e.tr.insert(n,o.createAndFill());s.setSelection(l.U3.create(s.doc,n+1)),t(s.scrollIntoView())}return!0},M=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if((0,i.zy)(e.doc,r))return t&&t(e.tr.split(r).scrollIntoView()),!0}let r=n.blockRange(),o=r&&(0,i.jP)(r);return null!=o&&(t&&t(e.tr.lift(r,o).scrollIntoView()),!0)},V=(e,t)=>{let{$from:n,to:r}=e.selection,i,o=n.sharedDepth(r);return 0!=o&&(i=n.before(o),t&&t(e.tr.setSelection(l.nh.create(e.doc,i))),!0)};function I(e,t,n,r){let s,a,c,p=t.nodeBefore,d=t.nodeAfter,f,h,m=p.type.spec.isolating||d.type.spec.isolating;if(!m&&(s=t.nodeBefore,a=t.nodeAfter,c=t.index(),s&&a&&s.type.compatibleContent(a.type)&&(!s.content.size&&t.parent.canReplace(c-1,c)?(n&&n(e.tr.delete(t.pos-s.nodeSize,t.pos).scrollIntoView()),!0):!!t.parent.canReplace(c,c+1)&&!!(a.isTextblock||(0,i.n9)(e.doc,t.pos))&&(n&&n(e.tr.join(t.pos).scrollIntoView()),!0))))return!0;let g=!m&&t.parent.canReplace(t.index(),t.index()+1);if(g&&(f=(h=p.contentMatchAt(p.childCount)).findWrapping(d.type))&&h.matchType(f[0]||d.type).validEnd){if(n){let r=t.pos+d.nodeSize,l=o.FK.empty;for(let e=f.length-1;e>=0;e--)l=o.FK.from(f[e].create(null,l));l=o.FK.from(p.copy(l));let s=e.tr.step(new i.Wg(t.pos-1,r,t.pos,r,new o.Ji(l,1,0),f.length,!0)),a=s.doc.resolve(r+2*f.length);a.nodeAfter&&a.nodeAfter.type==p.type&&(0,i.n9)(s.doc,a.pos)&&s.join(a.pos),n(s.scrollIntoView())}return!0}let w=d.type.spec.isolating||r>0&&m?null:l.LN.findFrom(t,1),v=w&&w.$from.blockRange(w.$to),y=v&&(0,i.jP)(v);if(null!=y&&y>=t.depth)return n&&n(e.tr.lift(v,y).scrollIntoView()),!0;if(g&&u(d,"start",!0)&&u(p,"end")){let r=p,l=[];for(;l.push(r),!r.isTextblock;)r=r.lastChild;let s=d,a=1;for(;!s.isTextblock;s=s.firstChild)a++;if(r.canReplace(r.childCount,r.childCount,s.content)){if(n){let r=o.FK.empty;for(let e=l.length-1;e>=0;e--)r=o.FK.from(l[e].copy(r));n(e.tr.step(new i.Wg(t.pos-l.length,t.pos+d.nodeSize,t.pos+a,t.pos+d.nodeSize-a,new o.Ji(r,l.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function z(e){return function(t,n){let r=t.selection,i=e<0?r.$from:r.$to,o=i.depth;for(;i.node(o).isInline;){if(!o)return!1;o--}return!!i.node(o).isTextblock&&(n&&n(t.tr.setSelection(l.U3.create(t.doc,e<0?i.start(o):i.end(o)))),!0)}}let R=z(-1),O=z(1);function B(e,t=null){return function(n,r){let{$from:o,$to:l}=n.selection,s=o.blockRange(l),a=s&&(0,i.oM)(s,e,t);return!!a&&(r&&r(n.tr.wrap(s,a).scrollIntoView()),!0)}}function E(e,t=null){return function(n,r){let i=!1;for(let r=0;r<n.selection.ranges.length&&!i;r++){let{$from:{pos:o},$to:{pos:l}}=n.selection.ranges[r];n.doc.nodesBetween(o,l,(r,o)=>{if(i)return!1;if(!(!r.isTextblock||r.hasMarkup(e,t)))if(r.type==e)i=!0;else{let t=n.doc.resolve(o),r=t.index();i=t.parent.canReplaceWith(r,r+1,e)}})}if(!i)return!1;if(r){let i=n.tr;for(let r=0;r<n.selection.ranges.length;r++){let{$from:{pos:o},$to:{pos:l}}=n.selection.ranges[r];i.setBlockType(o,l,e,t)}r(i.scrollIntoView())}return!0}}function N(...e){return function(t,n,r){for(let i=0;i<e.length;i++)if(e[i](t,n,r))return!0;return!1}}let P=N(s,c,h),$=N(s,w,v),D={Enter:N(x,A,M,(e,t)=>{let{$from:n,$to:r}=e.selection;if(e.selection instanceof l.nh&&e.selection.node.isBlock)return!!n.parentOffset&&!!(0,i.zy)(e.doc,n.pos)&&(t&&t(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let o=[],s,a,c=!1,p=!1;for(let e=n.depth;;e--){if(n.node(e).isBlock){let t;c=n.end(e)==n.pos+(n.depth-e),p=n.start(e)==n.pos-(n.depth-e),a=T(n.node(e-1).contentMatchAt(n.indexAfter(e-1)));o.unshift(t||(c&&a?{type:a}:null)),s=e;break}if(1==e)return!1;o.unshift(null)}let d=e.tr;(e.selection instanceof l.U3||e.selection instanceof l.i5)&&d.deleteSelection();let f=d.mapping.map(n.pos),u=(0,i.zy)(d.doc,f,o.length,o);if(u||(o[0]=a?{type:a}:null,u=(0,i.zy)(d.doc,f,o.length,o)),!u)return!1;if(d.split(f,o.length,o),!c&&p&&n.node(s).type!=a){let e=d.mapping.map(n.before(s)),t=d.doc.resolve(e);a&&n.node(s-1).canReplaceWith(t.index(),t.index()+1,a)&&d.setNodeMarkup(d.mapping.map(n.before(s)),a)}return t&&t(d.scrollIntoView()),!0}),"Mod-Enter":S,Backspace:P,"Mod-Backspace":P,"Shift-Backspace":P,Delete:$,"Mod-Delete":$,"Mod-a":(e,t)=>(t&&t(e.tr.setSelection(new l.i5(e.doc))),!0)},K={"Ctrl-h":D.Backspace,"Alt-Backspace":D["Mod-Backspace"],"Ctrl-d":D.Delete,"Ctrl-Alt-Backspace":D["Mod-Delete"],"Alt-Delete":D["Mod-Delete"],"Alt-d":D["Mod-Delete"],"Ctrl-a":R,"Ctrl-e":O};for(let e in D)K[e]=D[e];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform()}}]);